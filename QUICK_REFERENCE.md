# Quick Reference

## üöÄ Quick Commands

```bash
# Setup (first time only)
./setup.sh

# Close/lock the door
./bin/close

# Handle webhook events
./bin/callback <event> <timestamp> <data>

# Update scripts
./bin/update
```

## ‚è∞ Crontab Scheduling (Main Use Case)

```bash
# Edit crontab
crontab -e

# Examples:
# Close door every night at 10 PM
0 22 * * * /path/to/tedee-scripts/bin/close

# Close every weekday at 11 PM
0 23 * * 1-5 /path/to/tedee-scripts/bin/close

# Close on weekends at midnight
0 0 * * 6,0 /path/to/tedee-scripts/bin/close

# With logging
0 22 * * * /path/to/tedee-scripts/bin/close >> /tmp/tedee.log 2>&1
```

**Note:** Always use absolute paths in crontab!

## üìÅ File Locations

| What | Where |
|------|-------|
| Your config | `config/tedee.conf` (generated by setup) |
| Callback script | `bin/callback` |
| Close script | `bin/close` |
| Update script | `bin/update` |
| Common functions | `lib/tedee-common.sh` |
| Setup script | `setup.sh` |

## üîß Configuration Variables

Edit `config/tedee.conf`:

| Variable | Required | Description |
|----------|----------|-------------|
| `BRIDGE_IP` | ‚úÖ Yes | Tedee Bridge IP address |
| `TEDEE_TOKEN` | ‚úÖ Yes | Tedee API token |
| `AUTH_TYPE` | ‚úÖ Yes | Authentication type: `encrypted` or `non-encrypted` (default: encrypted) |
| `DEVICE_ID` | ‚úÖ Yes | Lock device ID |
| `TELEGRAM_TOKEN` | ‚ùå No | Telegram bot token (for notifications) |
| `CHAT_ID` | ‚ùå No | Telegram chat ID (for notifications) |
| `MAX_RETRIES` | ‚úÖ Yes | Number of retry attempts (default: 3) |
| `SLEEP_BETWEEN` | ‚úÖ Yes | Seconds between retries (default: 5) |
| `LOCALE` | ‚úÖ Yes | Language for notifications: `en` or `es` (default: en) |

## üîê Lock States

| Code | State | Description |
|------|-------|-------------|
| 0 | Uncalibrated | Lock needs calibration |
| 1 | Calibration | Lock is calibrating |
| 2 | Open | üîì Door is open |
| 3 | Partially Open | Partially open |
| 4 | Opening | üîÑ Currently opening |
| 5 | Closing | üîÑ Currently closing |
| 6 | Closed | üîí Door is closed |
| 7 | Pull Spring | Pull spring mode |
| 8 | Pulling | Currently pulling |
| 9 | Unknown | Unknown state |
| 255 | Unpulling | Currently unpulling |

## üì° Webhook Events

The callback script handles all Tedee Bridge API webhook events. For the complete list of events and their payloads, see the [official Tedee webhook events documentation](https://github.com/tedee-com/tedee-documentation/blob/master/bridge-api/webhooks/events.md).

**Usage:**
```bash
# Timestamp format: ISO 8601 (e.g., 2023-07-25T14:41:48.825Z)
./bin/callback "lock-status-changed" "2023-07-25T14:41:48.825Z" '{"deviceId":289001,"state":6}'
```


## üîÑ Common Tasks

### First Time Setup
```bash
./setup.sh
# Follow the interactive prompts
```

### Schedule Auto-Close (Cron) - Primary Use Case
```bash
# Edit crontab
crontab -e

# Close every night at 10 PM
0 22 * * * /path/to/tedee-scripts/bin/close

# Close weekdays at 11 PM with logging
0 23 * * 1-5 /path/to/tedee-scripts/bin/close >> /tmp/tedee.log 2>&1
```

### Add to PATH (Optional)
```bash
# Add to ~/.zshrc or ~/.bashrc
export PATH="$HOME/Projects/opensource/tedee-scripts/bin:$PATH"

# Reload shell
source ~/.zshrc  # or source ~/.bashrc

# Then in crontab you can use just:
0 22 * * * close
```

### Test Configuration
```bash
# Test manually first
./bin/close

# Check crontab logs (macOS)
log show --predicate 'process == "cron"' --last 1h

# Check system log (Linux)
grep CRON /var/log/syslog
```

### Update Scripts
```bash
# Update to latest version from main branch
./bin/update

# Update from a specific branch
./bin/update develop

# Schedule automatic updates (weekly on Sunday at 3 AM)
crontab -e
# Add: 0 3 * * 0 /path/to/tedee-scripts/bin/update >> /tmp/tedee-update.log 2>&1
```

**Note:** Update script uses `curl` and `tar` (no Git required). Perfect for Docker/minimal environments.

## üêõ Troubleshooting

### "Bridge is not responding"
- Check if bridge is powered on
- Verify `BRIDGE_IP` in config
- Test: `ping <BRIDGE_IP>`

### "Configuration file not found"
- Run setup to create config: `./setup.sh`
- Or verify `config/tedee.conf` exists

### "Permission denied"
```bash
# Make scripts executable
chmod +x bin/*
```

### Telegram notifications not working
- Verify `TELEGRAM_TOKEN` is correct
- Verify `CHAT_ID` is correct
- Telegram is optional - scripts work without it

## üìö Documentation

- **README.md** - Full documentation and getting started
- **QUICK_REFERENCE.md** - This file (quick commands and tips)

## üí° Tips

1. **Test first**: Run your scripts manually and verify behavior before locking/unlocking or adding cron jobs
2. **Backup config**: Keep a backup of `config/tedee.conf`
3. **Use PATH**: Add `bin/` to PATH for convenience
4. **Telegram optional**: Works fine without Telegram notifications
5. **Check logs**: Add logging for automated tasks (cron)
6. **Change language**: Run `./setup.sh` to switch between English and Spanish notifications

## üîó Useful Links

- Tedee Bridge API Documentation: https://api.tedee.com/
- Telegram Bot API: https://core.telegram.org/bots/api
