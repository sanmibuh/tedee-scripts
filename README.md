# tedee-scripts

Shell scripts for controlling Tedee Smart Locks via the Tedee Bridge API.

## ğŸ“ Project Structure

```
tedee-scripts/
â”œâ”€â”€ bin/                    # Executable scripts
â”‚   â”œâ”€â”€ close              # Close/lock the door
â”‚   â””â”€â”€ update             # Update repository
â”œâ”€â”€ config/                 # Configuration files
â”‚   â””â”€â”€ tedee.conf         # Your config (not in git, generated by setup)
â”œâ”€â”€ lib/                    # Shared libraries
â”‚   â””â”€â”€ tedee-common.sh    # Common functions
â”œâ”€â”€ setup.sh               # Interactive setup
â”œâ”€â”€ README.md
â””â”€â”€ LICENSE
```

## ğŸš€ Quick Start

### 1. Configuration

Run the interactive setup script:

```bash
./setup.sh
```

The setup script will:
- Guide you through entering all required settings
- Validate mandatory parameters (Bridge IP, API Token, Device ID)
- Optionally configure Telegram notifications
- Create the configuration file automatically
- Make all scripts executable

To reconfigure later, simply run `./setup.sh` again.

### 2. Usage

Close/lock the door:
```bash
./bin/close
```

Update to the latest version:
```bash
./bin/update
```

### 3. Schedule with Crontab

The main purpose of these scripts is automation via crontab. Examples:

```bash
# Edit your crontab
crontab -e

# Auto-close door every night at 10 PM
0 22 * * * /path/to/tedee-scripts/bin/close

# Auto-close door every weekday at 11 PM
0 23 * * 1-5 /path/to/tedee-scripts/bin/close

# Auto-close on weekends at midnight
0 0 * * 6,0 /path/to/tedee-scripts/bin/close >> /tmp/tedee-close.log 2>&1
```

**Tip:** Use absolute paths in crontab for reliability.

### 4. Optional: Add to PATH

To run scripts from anywhere, add the bin directory to your PATH:

```bash
# Add to your ~/.zshrc or ~/.bashrc
export PATH="$HOME/Projects/opensource/tedee-scripts/bin:$PATH"
```

Then you can run:
```bash
close
update
```

## ğŸ“‹ Requirements

- `curl` - For API requests
- `sha256sum` - For API token generation (or `shasum -a 256` on macOS)
- `ping` - For bridge connectivity checks
- `git` - For the update script

## ğŸ”§ Features

### Close Script (`bin/close`)
- Checks bridge connectivity before attempting to close
- Retries on failure (configurable)
- Reports lock status
- Optional Telegram notifications
- Validates door state before and after closing
- Perfect for crontab automation

### Common Library (`lib/tedee-common.sh`)
- Shared functions for all Tedee scripts
- Bridge communication and API key generation
- Lock state checking and waiting
- Telegram notification support
- Configuration validation

## ğŸ› ï¸ Development

The project is structured to make it easy to add new scripts:

1. Create a new script in `bin/`
2. Source the common library: `. "$SCRIPT_DIR/lib/tedee-common.sh"`
3. Use shared functions like `load_config()`, `get_lock_state()`, etc.
4. Make it executable: `chmod +x bin/your-script`

## ğŸ“ Documentation

- **QUICK_REFERENCE.md** - Quick commands, troubleshooting, and tips

## ğŸ“ License

See LICENSE file for details.

